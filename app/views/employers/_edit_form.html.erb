<%= form_for(@employer) do |f| %>  
	<div class="standard-section-header">Employer profile</div>
	<div class="section-box">
		<div class="form-row clearfix">
			<div class="form-column">
				<div class="form-cell">
					<%= label_tag(nil, "Contact person first name", :class=>"mandatory") %><br>
					<%= text_field_tag(:first_name, @employer.first_name, :spellcheck =>false, :maxlength => 60, :class=>"validate[required,custom[nonEmpty]] half-row-width input-attr") %>
				</div>
				<div class="form-cell">
					<%= label_tag(nil, "Company name", :class=>"mandatory") %><br>
					<a class="field-tooltip" title="The name of your own organization (whether you are an employer or a recruiter)"></a>	
					<%= text_field_tag :company_name, @employer.company_name, :maxlength=> 60, :spellcheck =>false, :class=>"validate[required,custom[nonEmpty]] half-row-width input-attr" %>
				</div>
				<div class="form-cell">
					<%= label_tag(nil, raw("Email"), :class=>"mandatory") %><br>
					<a class="field-tooltip" title="You will get a confirmation email for activating your profile."></a>			
					<%= text_field_tag :email, @employer.email, :maxlength=>255, :spellcheck =>false, :class=>"validate[required, custom[email]] half-row-width input-attr" %>
				</div>
			</div>
			
			<div class="form-column">
				<div class="form-cell">
					<%= label_tag(nil, "Contact person last name", :class=>"mandatory") %><br>
					<%= text_field_tag(:last_name, @employer.last_name, :spellcheck =>false, :maxlength => 60, :class=>"validate[required,custom[nonEmpty]] half-row-width input-attr") %>
				</div>
				<div class="form-cell">
					<%= label_tag(nil, "Your LinkedIn profile URL") %><br>
					<a class="field-tooltip" title="Personalize your communication with the candidates."></a>
					<%= text_field_tag(:li_url, @employer.li_url, :spellcheck =>false, :maxlength => 250, :class=>"validate[custom[linkedin], custom[url]] half-row-width input-attr") %>				
				</div>
			</div>
		</div>
	</div>	
	
	<a name="plans-and-pricing" style="visibility: hidden"></a>
	<div class="standard-section-header">Plans and pricing</div>
	<div class="section-box">
		<div class="form-cell">	
			<table id="plans-and-pricing-table">	
				<tr class="headline">
					<th></th>
					<th class="free"><%= EmployerPlan::FREE%></th>
					<th class="pro"><%= EmployerPlan::PRO%></th>
					<th class="enterprise"><%= EmployerPlan::ENTERPRISE%></th>				
				</tr>
				<tr class="odd monthly-subscription">
					<td class="feature-name">Monthly subscription</td>
					<td class="feature-value free"><%=Utils::monthly_price_s(Constants::TIER_FREE)%></td>
					<td class="feature-value pro"><%=Utils::monthly_price_s(Constants::TIER_PRO)%></td>
					<td class="feature-value enterprise"><%=Utils::monthly_price_s(Constants::TIER_ENTERPRISE)%></td>
				</tr>	
				<tr class="even check-mark">
					<td class="feature-name">&ldquo;Come Work With Us&rdquo; widget</td>
					<td class="feature-value">&#10003;</td>
					<td class="feature-value">&#10003;</td>
					<td class="feature-value">&#10003;</td>				
				</tr>
				<tr class="odd">
					<td class="feature-name">Open job positions highlighted in an attractive ad across multiple channels</td>
					<td class="feature-value">1</td>
					<td class="feature-value">2-5</td>
					<td class="feature-value">Unlimited</td>				
				</tr>
				<tr class="even">
					<td class="feature-name">Employee-centered recruiting</td>
					<td class="feature-value">Unlimited</td>
					<td class="feature-value">Unlimited</td>
					<td class="feature-value">Unlimited</td>				
				</tr>
				<tr class="odd check-mark">
					<td class="feature-name">Expert screening of all leads by <%=Constants::SHORT_SITENAME%></td>
					<td class="feature-value"></td>
					<td class="feature-value"></td>
					<td class="feature-value">&#10003;</td>				
				</tr>
				<tr class="even">
					<td class="feature-name">Search and ping <%=Constants::SHORT_SITENAME%> members</td>
					<td class="feature-value">Unlimited</td>
					<td class="feature-value">Unlimited</td>
					<td class="feature-value">Unlimited</td>					
				</tr>	
				<tr class="odd check-mark">
					<td class="feature-name">Dedicated customer success representative</td>
					<td class="feature-value"></td>
					<td class="feature-value"></td>
					<td class="feature-value">&#10003;</td>				
				</tr>
				<tr class="footer">
					<td class=""></td>
					<% 
					default_tier = -1 
					unless @employer.current_plan.nil? 
						default_tier = @employer.current_plan.tier
					end
					%>
		  			<%# Signature is radio_button_tag(name, value, checked , options = {})%>
					<td class="free"><%= radio_button_tag 'tier', Constants::TIER_FREE.to_s, default_tier == Constants::TIER_FREE, :class => "validate[required]" %><br>Try the <%=EmployerPlan::FREE%> plan</td>
					<td class="pro"><%= radio_button_tag 'tier', Constants::TIER_PRO.to_s, default_tier == Constants::TIER_PRO, :class => "validate[required]" %><br>Try the <%=EmployerPlan::PRO%> plan</td>
					<td class="enterprise"><%= radio_button_tag 'tier', Constants::TIER_ENTERPRISE.to_s, default_tier == Constants::TIER_ENTERPRISE, :class => "validate[required]" %><br>Try the <%=EmployerPlan::ENTERPRISE%> plan</td>
				</tr>				
			</table>
		</div>
	</div>
	
	<div class="buttons-box">
		<%if @employer.new_record? %>
			<% board = params[:board] %>
			<%if board%>
				<%= hidden_field_tag(:board, board) %>
			<%end%>	

			<%= submit_tag "Get Started", :class=>"standard-button", :id=>"submit", :name => nil %>
		<%else%>
			<%= submit_tag "Update", :id=>"submit", :class=>"standard-button", :name => nil %>
			&nbsp;&nbsp;
			<%= link_to "Cancel", employer_path(@employer), :class=>"cancel-button" %>
		<%end%>	
	</div>			
<% end %>

<script type="text/javascript">
	function doSubmitForm() {
		createValidUrl($("#li_url"));
		var res = $("form.new_employer, form.edit_employer").validationEngine('validate');
		if (res) {
			// prevent double submit
	 		if($('#submit').attr("disabled") != "disabled") {
	 			$('#submit').focus();
				$('#submit').attr('disabled','disabled');	 			
			}
	    }
	
		return res;
	}
   
	$("form.new_employer").submit(function(){
		if(doSubmitForm()) {
			trackEvent("employer", "new profile created");
		} else {
			trackEvent("employer", "new profile failed");
			return false;
		}
		
		return true;
	});
	
	$("form.edit_employer").submit(function(){
		if(doSubmitForm()) {
			trackEvent("employer", "profile updated");
		} else {
			trackEvent("employer", "error updating profile");
			return false;
		}
		
		return true;
	});	
	
	$("tr.footer .free, tr.footer .pro, tr.footer .enterprise").click(function(e) {
		if(e.target == this) {
			$(this).children("input").prop('checked',true);
		}
	});
	
	//https://bugzilla.mozilla.org/show_bug.cgi?id=443289
	window.addEventListener('pageshow', PageShowHandler, false);
	window.addEventListener('unload', UnloadHandler, false);
	
	function PageShowHandler() {
		$('#submit').removeAttr('disabled');
		window.addEventListener('unload', UnloadHandler, false);
	}
	
	function UnloadHandler() {
		window.removeEventListener('unload', UnloadHandler, false);
	}
</script>
